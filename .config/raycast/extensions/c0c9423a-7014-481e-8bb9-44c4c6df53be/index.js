"use strict";var h=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var z=(o,n)=>{for(var i in n)h(o,i,{get:n[i],enumerable:!0})},K=(o,n,i,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of B(n))!F.call(o,s)&&s!==i&&h(o,s,{get:()=>n[s],enumerable:!(c=R(n,s))||c.enumerable});return o};var W=o=>K(h({},"__esModule",{value:!0}),o);var Q={};z(Q,{default:()=>g});module.exports=W(Q);var t=require("@raycast/api"),m=require("child_process"),P=require("react");var p=require("react"),q=()=>{};function H(o,n){let i=(0,p.useRef)(q);(0,p.useEffect)(()=>{i.current=o},[o]),(0,p.useEffect)(()=>{if(i.current(),(n??0)>0){let s=Math.max(n??0,1e3),d=setInterval(()=>i.current(),s);return()=>clearInterval(d)}},[n])}var I=H;var a=require("react/jsx-runtime");function g(){let[o,n]=(0,P.useState)([]),[i,c]=(0,P.useState)(void 0),s=(0,t.getPreferenceValues)(),d=s.shouldSearchInPaths??!1,C=s.shouldSearchInPid??!1,S=s.shouldPrioritizeAppsWhenFiltering??!1,b=s.shouldShowPID??!1,w=s.shouldShowPath??!1,A=+s.refreshDuration,y=()=>{(0,m.exec)("ps -eo pid,pcpu,comm | sort -nrk 2,3",(e,r)=>{if(e!=null)return;let l=r.split(`
`).map(u=>{let[,L,T,f]=u.match(/(\d+)\s+(\d+[.|,]\d+)\s+(.*)/)??["","","",""],D=f.match(/[^/]*[^/]*$/i)?.[0]??"",E=f.includes(".prefPane"),M=f.includes(".app");return{id:L,cpu:T,path:f,name:D,type:E?"prefPane":M?"app":"binary"}}).filter(u=>u.name!=="");n(l)})};I(y,A);let $=e=>e.type==="prefPane"?{fileIcon:e.path?.replace(/(.+\.prefPane)(.+)/,"$1")??""}:e.type==="app"?{fileIcon:e.path?.replace(/(.+\.app)(.+)/,"$1")??""}:"/System/Library/CoreServices/CoreTypes.bundle/Contents/Resources/ExecutableBinaryIcon.icns",k=e=>{(0,m.exec)(`kill -9 ${e.id}`),n(o.filter(r=>r.id!==e.id)),(0,t.clearSearchBar)({forceScrollToTop:!0}),(0,t.showHUD)(`\u2705 Killed ${e.name==="-"?`process ${e.id}`:e.name}`)},v=e=>e.path==null?null:(0,a.jsx)(t.Action.CopyToClipboard,{title:"Copy Path",content:e.path}),x=e=>{let r;return b&&(r=e.id),w&&(r=r?`${r} - ${e.path}`:e.path),r};return(0,a.jsx)(t.List,{isLoading:o.length===0,searchBarPlaceholder:"Filter by name...",onSearchTextChange:e=>c(e),children:o.filter(e=>{if(i==null)return!0;let r=e.name.toLowerCase().includes(i.toLowerCase()),l=e.path?.toLowerCase().match(new RegExp(`.+${i}.*\\.[app|framework|prefpane]`,"ig"))!=null,u=e.id.includes(i);return r||d&&l||C&&u}).sort((e,r)=>{if(i!=null&&S){if(e.type==="app"&&r.type!=="app")return-1;if(e.type!=="app"&&r.type==="app")return 1}return 0}).map((e,r)=>{let l=$(e);return(0,a.jsx)(t.List.Item,{title:e.name,subtitle:x(e),icon:l,accessories:[{text:`${e.cpu}%`}],actions:(0,a.jsxs)(t.ActionPanel,{children:[(0,a.jsx)(t.ActionPanel.Item,{title:"Kill",icon:t.Icon.XmarkCircle,onAction:()=>k(e)}),v(e),(0,a.jsx)(t.ActionPanel.Item,{title:"Reload",icon:t.Icon.ArrowClockwise,shortcut:{key:"r",modifiers:["cmd"]},onAction:()=>y()})]})},r)})})}
